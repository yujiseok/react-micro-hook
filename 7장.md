# 사용 사례 시나리오 1: Zustand

Zustand는 모듈 상태를 생성하도록 설계된 작은 라이브러리다.
상태 객체를 수정할 수 없고 항상 새로 만드는 불면 갱신 모델 기반
수동으로 렌더링 최적화 → 선택자
store 생성자 인터페이스 존재

## 모듈 상태와 불변 상태 이해하기

Zustand는 store를 만드는 데 사용됨
모듈에서 store를 정의하고 내보냄
상태 객체 속성을 갱신할 수 없음 → 새 객체 생성해 대체 → 수정되지 않은 객체 재사용

불변 상태 모델의 장점

- 객체의 참조에 대한 동등성만 확인해 변경 여부 파악 → 객체 전체 값 확인 필요 x

> 리액트에서 불변 상태가 중요한 이유
>
> 상태의 변경을 직접 수행하지 않고 새로운 상태 객체를 생성해 상태를 업데이트 하는 방식
> 불변성이 중요한 이유
>
> - 리액트는 얕은 비교를 통해 객체의 참조 주소만 비교해 상태 변화를 감지한다.
> - 참조 주소가 변경된 경우만, 컴포넌트를 리렌더
> - 불변성을 통한 상태 변화 예측 가능

상태는 불변해야하므로, state.count = 2 또는 ++state.count 와 같이 작성할 경우 상태의 변경을 감지하지 못한다.
반드시 새로운 객체를 생성해 변경해야 한다.

스토어의 setState는 상태를 이전 상태와 병합(`Object.assign()`) 하므로, 설정하려는 속성만 지정해도 됨.

## 리액트 훅을 이용한 리렌더링 최적화

리액트에서 스토어를 사용하려면 커스텀 훅이 필요함 useXXX

```ts
export const useStore = create(() => {
  count: 0;
  text: "hello";
});
```

이런 훅이 필요하다.

사용처에서

```ts
const { count, text } = useStore();
```

이렇게 사용한다면, count가 변경될 때마다 리렌더링된다. 하지만, text가 변경될 때도 화면이 리렌더링 됨

이렇게 리렌더링을 피해야할 때, 선택자 함수를 사용하자.

```ts
const Component = () => {
  const count = useStore((state) => state.count);
};
```

이렇게 하면 count 값이 변경될 때만 리렌더링됨

이 같은 선택자 기반 리렌더링 제어를 수동 리렌더링 최적화라고 한다.
선택자 기반의 장점은 함수가 명시적이기에 동작을 정확히 예측할 수 있다는 점
단점은 객체 참조에 대한 이해가 필요하다.

## 읽기 상태와 갱신 상태 사용하기

스토어 생성자 함수의 첫 번째 인수는 스토어의 상태를 변경하는 setState 함수다.

```ts
type StoreState = {
  count1: number;
  count2: number;
  inc1: () => void;
  inc2: () => void;
};

const useStore = create<StoreState>((set) => {
  count1: 0;
  count2: 0;
  inc1: () => set((prev) => ({ count1: prev.count1 + 1 }));
  inc2: () => set((prev) => ({ count2: prev.count2 + 1 }));
});
```

스토어 내부에 상태를 변경하는 함수가 존재하게 됨

사용처에서 해당 함수를 선택자로 사용하면 된다.
파생 상태의 경우 선택자에서 계산하는 것도 좋지만
스토어에 파생 상태를 생성할 수 있다.
흔하게 사용되진 않지만, 계산이 매우 많을 경우 중요하다.

## 구조화된 데이터 처리하기

간단한 투두 예제를 통해 구조화된 상태를 다루는 것을 실습함

## 이 접근 방식과 라이브러리의 장단점

Zustand의 읽기 및 쓰기 상태

- 읽기 상태: 리렌더링을 최적화하기 위해 선택자 함수를 사용한다.
- 쓰기 상태: 불변 상태 모델을 기반으로 한다.

핵심은 리액트가 최적화를 위해 객체 불변성을 기반으로 한다는 점
객체가 변해야 감지한다.

Zustand도 동일한 멘탈 모델을 갖는다.
즉 선택자 함수가 참조적으로 동일한 객체 또는 값을 반환하면 변경되지 않은 것으로 간주하고 리렌더링을 일으키지 않는다.

Zustand는 리액트의 동일한 모델과 가볍다는 장점이 있다.
단점으론 선택자를 사용해 수동 렌더링 최적화를 해야하는 것.
