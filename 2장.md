# 2장 지역 상태와 전역 상태 사용하기

리액트 컴포넌트는 트리 구조를 구성 → 이 구조에서 지역 상태를 만드는 것은 쉽다.
지역 상태 생성 → 컴포넌트, 자식 컴포넌트 상태 사용 → 재사용과 지역성에 좋다.

하지만, 트리 내 서로 떨어진 컴포넌트에 공통 상태가 사용되어야 한다면? → 전역 상태 필요

전역 상태는 지역 상태와 다르게 특정 컴포넌트에 귀속되지 않음

## 언제 지역 상태를 사용할까?

우선 순수 함수와 비순수 함수를 살펴보자.

- 순수 함수
  - 오직 인수에만 의존해 동일한 인수를 받을 경우 동일한 값 반환
- 비순수 함수
  - 인수 외부의 값에 의존해 예측할 수 없는 값을 반환하는 경우
  - 상태는 외부 인수일 수 있다.

리액트 컴포넌트도 함수이다. 상태가 컴포넌트 내에서만 사용되고 다른 컴포넌트에 영향을 주지 않을 경우 , 억제되었다고 할 수 있다.

- 순수성과 멱등성
  - 멱등성: 연산을 여러 번 적용해도 결과가 달라지지 않는 성질
  - 모든 순수 함수는 멱등성을 갖지만, 모든 멱등 함수가 순수 함수인 것은 아니다. 교집합인가

### 리액트 컴포넌트와 props

컴포넌트는 UI 변환 함수. props를 받아 계산하는 것은 순수 함수와 유사

### 지역 상태에 대한 useState 이해하기

상태에 의존하는 컴포넌트는 엄밀하게 순수하지 않다.

상태를 변경하는 함수가 변하지 않는 한 멱등성을 지닌다. 컴포넌트 내부에서만 지역 상태를 사용하는 경우 억제되었다고 할 수 있다. 억제된 컴포넌트는 외부 어떤것에 영향을 주지 않기에, 지역성을 보장한다.

### 지역 상태의 한계

컴포넌트 외부에서 상태를 변경하고 싶을 경우. 전역 상태는 컴포넌트 외부에서 컴포넌트를 제어할 수 있지만, 동작 예측을 어렵게 한다.

## 지역 상태를 효과적으로 사용하는 방법

### 상태 끌어올리기

부모 컴포넌트를 생성해 공유 되는 상태를 props로 전달하는 법

상태를 부모 컴포넌트로 끌어올렸기에, 상태가 변경될 경우 하위 모든 자식 요소가 리렌더링 된다.

- 개별적으로 상태를 사용하는 것이 아닌, 부모 컴포넌트에서 하위 계층으로 공유하기 위해서 사용됨

### 내용 끌어올리기

상태에 의존하지 않는 컴포넌트가 존재할 경우, 리렌더가 필요 없다.

즉 `children` 프랍을 뚫어 상위에서 컴포넌트를 전달한다.

> ❓ 왜 children 프랍은 부모의 상태가 변경되어도 리렌더 되지 않을까?
>
> - 실제 계층 관계에서 봤을 때, 부모 - 자식 관계로 children 프랍이 트리에 포함 되어있으나 단순히 렌더의 결과물을 전달해서
> - 실제 부모의 마운트가 완료될 때까지, 자식은 마운트되지 않는다.
> - 실제 자식 컴포넌트가 트리에 위치하기 전까지 평가되지 않음
> - 클라이언트 컴포넌트 내에서 서버 컴포넌트를 쓰기 위해 프로바이더를 만드는 것과 비슷한 이치일까?
>
> 실제로 큐레이션 헤더에 적용해 봄
> [참고](https://www.reddit.com/r/reactjs/comments/15k98lf/why_does_passing_child_as_prop_to_parent_prevent/), [참고](https://kentcdodds.com/blog/optimize-react-re-renders)

## 전역 상태 사용하기

### 전역 상태란?

하나의 컴포넌트에 속해 캡슐화된 상태를 지역 상태라고 함
이와 반대로 하나의 컴포넌트에 속해있지 않고 여러 컴포넌트에서 공통으로 사용되는 상태를 전역 상태라고 함

전역 상태가 싱글턴이 아닌 경우, 컴포넌트 트리 다른 부분에 대해 여러 값을 갖는다.

### 언제 전역 상태를 사용할까?

두 가지 상황에서 전역 상태를 사용한다.

- props 드릴링이 발생할 때
- 이미 리액트 외부에 상태가 있을 때

### props 드릴링

컴포넌트 계층 구조 상 멀리 떨어져 있을 경우 props로 상태를 공유하는 것은 적절하지 않다. 여러 단계의 상태가 불필요한 컴포넌트에 props를 전달하는 것은 번거로우며, 리렌더링 유발, 추적이 까다롭다.

이때 전역 상태를 사용해, 중간 컴포넌트에 상태 전달을 방지할 수 있다.

> 💡 프랍 드릴링의 기준은 몇 단계일까?

### 이미 리액트 외부에 상태가 있을 때

리액트에 의존하지 않고 취득한 정보(e.g. 회원정보) 처리 시 사용한다.
