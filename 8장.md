# 사용 사례 시나리오 2: Jotai

조타이는 전역 상태를 위한 작은 라이브러리 상태를 변경하는 훅과 아톰이라는 것을 사용.
zustand와 달리 컴포넌트 상태를 사용하며, 공통적으로 불변 상태 모델이다.

아톰을 통해 의존성 추적 / 리렌더링 감지 가능
아톰 자체로 값이 없으므로 재사용 가능
배열의 경우 atoms-in-atom 기법으로 렌더링 최적화 가능

## 조타이 이해하기

컨텍스트 대신 조타이를 사용하면 얻을 수 있는 이점

### 1. 구문 단순성

기본적으로 한 줄의 아톰 정의로 가능하다. 아톰이 많아져도 각 아톰에 대한 코드 한 줄만 추가하면 된다. 반면에 컨텍스트의 경우 이것저것 추가해야함

구문 단순성은 새로운 기능을 제공하는 것은 아님.

### 2. 동적 아톰 생성

아톰은 리액트 생명주기에 생성되고 소멸된다. 컨텍스트는 그게 불가능하다.

조타이는 기본적으로 위크맵(WeakMap) 객체다.
아톰 구성 객체는 아톰 함수로 생성된다. 아톰 값은 `useAtom`의 반환값이다.

## 렌더링 최적화

스토어에서 선택자를 만들어 값이 변경되지 않아도 렌더링되는 것을 방지할 수 있다. 이런 접근 방식을 하향식 접근법이라고 한다.

**아톰은 리렌더링을 감지하는 단위다.** 아톰을 원시 값처럼 만들 수 있고, 객체로 만들 수 있다.

```ts
const nameAtom = atom("React");
const ageAtom = atom(1);
```

객체의 경우 read 함수를 사용해 만들 수 있는데,

```ts
const personAtom = atom((get) => ({
  firstName: get(firstNameAtom),
  lastName: get(lastNameAtom),
  age: get(ageAtom),
}));
```

하지만 속성이 변경될 때마다 갱신되므로, 렌더링에 연관이 없어도 리렌더링 된다.
이것을 의존성 추적이라고한다. 조타이에서 자동으로 수행한다.

리렌더링이 필요하지 않다면, 사용하는 값만 파생 아톰으로 만들어야함
이런 방식은 상향식 접근법이다.

작은 아톰 + 작은 아톰 = 큰 아톰
사용될 아톰을 추가해 만듦

장점은 구성을 컴포넌트에 표시되는 것과 쉽게 연관 지을 수 있다는 점이다.

-> 메모이제이션 불필요

read함수로 파생 아톰 정의 가능

## 조타이가 아톰 값을 저장하는 방식 이해하기

원시 아톰은 useState와 동작하도록 설계됨.
하지만 각 아톰은 실제 값을 갖지 않는다. -> 스토어에 키가 아톰 구성 객체이고 값이 아톰 값인 위크맵 객체가 존재함

프로바이더로 아톰을 컴포넌트 별로 사용할 수 있는데, 이것은 서로 다른 스토어를 바라보게 된다.
아톰 구성은 값을 가지지 않는 정의일 뿐 재사용할 수 있다.
컨텍스트가 할 수 있는 것을 조타이도 다 한다.

## 배열 구조 추가하기

atoms-in-atom

- 배열 아톰은 아톰이 요소인 배열을 보관하는 데 사용된다.
- 배열에 새로운 요소를 추가하려면 새로운 아톰을 생성해서 추가해야 한다.
- 아톰 구성은 문자열로 평가되어 UID를 반환한다.
- 요소를 렌더링하는 컴포넌트는 각 컴포넌트에서 아톰 요소를 사용한다. -> 리렌더링 막음

## 조타이의 다양한 기능 사용하기

### write 함수 정의하기

원시 아톰은 변경할 수 있는 쓰기 가능한 아톰
쓰기 가능한 파생 아톰을 만들기 위해, read 함수가 아닌 write를 사용
게터, 세터와 비슷하다

```ts
const doubleCountAtom = atom(
  (get) => get(countAtom) * 2,
  (get, set, arg) => set(countAtom, arg / 2)
);
```

- get: 아톰의 값을 반환
- set: 아톰의 값을 설정
- arg: 아톰을 갱신할 때 받을 값

### 액션 아톰 사용하기

아톰의 두 번째 인수인 write 함수만 사용해서 상태를 변경하는 코드를 만들 수 있음

```ts
const countAtom = atom(0);

const incrementCountAtom = atom(null, (get, set, arg) =>
  set(countAtom, (c) => c + 1)
);
```

### 아톰의 onMount 옵션 이해하기

onMount onUnmount를 사용해 마운트 혹은 언마운트 시 동작하도록 할 수 있다. 이펙트 같은
