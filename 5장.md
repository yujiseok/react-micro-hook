# 5장 리액트 컨텍스트와 구독을 이용한 컴포넌트 상태 공유

컨텍스트를 사용하면, 트리마다 서로 다른 값을 제공할 수 있다. 구독은 불필요한 리렌더링을 막을 수 있다.

이 둘을 같이 쓴다면?

- 컨텍스트 → 하위 트리 전역 상태 제공, 프로바이더 중첩 가능 → 생명 주기 내에서 `useState` 와 같은 훅으로 전역 상태 관리 가능
- 구독 → 단일 컨텍스트는 불가능한 리렌더링 문제를 해결할 수 있다.

## 모듈 상태의 한계

모듈은 리액트 외부에 존재하는 전역으로 정의된 싱글턴 → 컴포넌트 트리나 하위 트리마다 다른 상태를 가질 수 없음

비슷한 스토어를 항상 재생산 해야 한다. → 이상적으로 카운터는 컴포넌트는 재사용 가능해야 하지만, 모듈 상태는 리액트 외부에서 정의되기 때문에 불가능하다.

> 💡 여러 컴포넌트에서 같은 모듈을 참조해서, 모두 동일한 인스턴스를 보게됨
> 그래서, 새로운 스토어를 만들고 그 스토어를 사용하는 동일한 컴포넌트를 만들어야함.

그럼 props로 내려 준다면? → prop drilling 발생함

```tsx
<StoreProvider>
  <Component />
  <Component />
</StoreProvider>
```

와 같이 프로바이더로 제공해주면 어떨까?

## 컨텍스트 사용이 필요한 시점

컨텍스트 프로바이더는 기본값 또는 부모 프로바이더가 제공하는 값이 있을 경우 값을 오버라이드한다.

전역 상태를 위한 컨텍스트는 서로 다른 하위 트리에 서로 다른 값을 제공해야 하는 경우에만 필요하다.

## 컨텍스트와 구독 패턴 사용하기

컨텍스트를 통해 스토어 객체를 가져온다. → 컴포넌트가 특정 스토어에 연결되어 있지 않음 → 컨텍스트 프로바이더 또는 기본 값으로 상태를 가질 수 있다.

- 모듈 상태란 모듈 수준에서 정의된 변수. (ES 모듈, 파일) → 함수 외부에 정의된 변수
- 리액트에서 모듈 상태를 사용하려면 렌더링 최적화를 고려해야 한다. 리렌더링을 일으키는 훅을 사용
- 모듈 상태를 통해 리액트에서 전역 상태를 사용할 수 있다.
  - 스토어만으로 어떻게 전역 상태를 관리하지 하는 의문이 조금 해결됨
  - 모듈 상태 → 결국 리액트에서 갱신 → 상태와 동일하게 모듈 상태 갱신
- 컨텍스트를 사용하면 계층에 필요한 값을 제공해 주며, 구독 방식은 불필요한 리렌더링을 막는다.
  - 두 장점을 모두 사용하는 방법
- 구독의 경우 재사용이 필요한 컴포넌트가 재사용 되기 어렵다. → 모듈 상태는 리액트 외부에 정의되어 있어서.
- 컨텍스트와 구독을 같이 사용한다면?
  - 하위 트리에 분리된 값을 제공하며, 리렌더링을 피한다.
  - 규모가 큰 애플리케이션에서 유용하다.
- 구독 방식이 어떤 식으로 구현되는지 알 수 있어서 흥미롭다.
